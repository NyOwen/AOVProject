<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>APL 2025 </title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>APL 2025 </h1>

  <div id="teamSelect">
    <label>Home:
      <select id="teamA">
        <option>FW</option><option>ONE</option><option>BMG</option><option>HKA</option><option>DCG</option><option>ANK</option>
        <option>EA</option><option>BAC</option><option>BRU</option><option>TLN</option><option>FS</option><option>PSG</option>
        <option>FPT</option><option>SGP</option><option>BOX</option><option>1S</option><option>SPN</option><option>TDT</option>
        <option>ASL1</option><option>ASL2</option>
      </select>
    </label>
    <label>Guest:
      <select id="teamB">
        <option>FW</option><option>ONE</option><option>BMG</option><option>HKA</option><option>DCG</option><option>ANK</option>
        <option>EA</option><option>BAC</option><option>BRU</option><option>TLN</option><option>FS</option><option>PSG</option>
        <option>FPT</option><option>SGP</option><option>BOX</option><option>1S</option><option>SPN</option><option>TDT</option>
        <option>ASL1</option><option>ASL2</option>
      </select>
    </label><br/>
    <label>BO
      <select id="boMode"><option value="3">3</option><option value="5">5</option><option value="7" selected>7</option></select>
    </label>
    <label><input type="checkbox" id="ultimateCheck" /> Ultimate BattleÔºàBO7‰∏≠Á¨¨7Â±ÄÁõ≤ÈÅ∏Ôºâ</label><br/>
    <button onclick="startSeries()">MATCH START</button>
  </div>

  <!-- ÈÅ∏ÈÇä -->
  <div id="sideSelect" style="display:none;">
    <p id="sideSelectPrompt" style="font-weight:bold;"></p>
    <button class="side-button" id="btnBlue">üîµ Blue Side</button>
    <button class="side-button" id="btnRed">üî¥ Red Side</button>
  </div>

  <!-- ÊØîÂàÜÈ°ØÁ§∫ -->
  <div id="scoreBoard"></div>
  <!-- LAST BP -->
  <div id="historySection">
  <h3>LAST BP</h3>
  <table id="historyTable" border="1" style="margin: 0 auto; border-collapse: collapse;">
    <thead>
      <tr>
        <th id="thHomeBan">‰∏ªÈöä BAN</th>
        <th id="thHomePick">‰∏ªÈöä PICK</th>
        <th id="thHomeSide">‰∏ªÈöä SIDE</th>
        <th>GAME</th>
        <th id="thGuestSide">ÂÆ¢Èöä SIDE</th>
        <th id="thGuestPick">ÂÆ¢Èöä PICK</th>
        <th id="thGuestBan">ÂÆ¢Èöä BAN</th>
      </tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>
</div>

  <!-- BPÈöéÊÆµË™™ÊòéÊèêÁ§∫ÊñáÂ≠ó -->
<div id="bpStageInfo"></div>

<!-- BPË°®Ê†ºÈ°ØÁ§∫ÂçÄ -->
<div id="bpTableContainer">
  <div id="bpTableWrapper" style="display: flex; justify-content: center; gap: 40px;">
    <!-- Blue Side Ë°®Ê†º -->
    <table class="bp-table">
      <tr>
        <td id="blueTitle">üîµ Blue Side</td>
        <td id="blueBan1"></td>
        <td id="blueBan2"></td>
        <td id="blueBan3"></td>
        <td id="blueBan4"></td>
      </tr>
      <tr>
        <td id="bluePick1"></td>
        <td id="bluePick2"></td>
        <td id="bluePick3"></td>
        <td id="bluePick4"></td>
        <td id="bluePick5"></td>
      </tr>
    </table>

    <!-- Red Side Ë°®Ê†º -->
    <table class="bp-table">
      <tr>
        <td id="redTitle">üî¥ Red Side</td>
        <td id="redBan1"></td>
        <td id="redBan2"></td>
        <td id="redBan3"></td>
        <td id="redBan4"></td>
      </tr>
      <tr>
        <td id="redPick1"></td>
        <td id="redPick2"></td>
        <td id="redPick3"></td>
        <td id="redPick4"></td>
        <td id="redPick5"></td>
      </tr>
    </table>
  </div>
</div>

  <div id="heroSection" style="display:none;">
    <div id="heroes"></div>
  </div>

  <!-- ÂãùË≤†ÈÅ∏Êìá -->
  <div id="winnerSelect" style="display:none;">
    <h3>Ë´ãÈÅ∏ÊìáÊú¨Â±ÄÁç≤ÂãùÈöä‰ºçÔºö</h3>
    <button id="btnWinA"></button>
    <button id="btnWinB"></button>
  </div>
  <!-- ÈáçÁΩÆÊú¨Â±ÄÊåâÈàï -->
  <div id="resetSection">
    <button onclick="resetCurrentGame()">Reset The Game</button>
  </div>
  
  

  <script>
   const heroes =["Â§úÂèâ","Â°îÊãâ","ÊÑõÈáå","Á≠±Ê∏Ö","ÈæçÈ¶¨","ËâæËúúËéâ","ÁæéÂ®ú","È∫•ÂÖãÊÄù","Á∑ãÊ∑ö",
    "ÂºóÊ¥õÂÄ´","Âè∏ÁßëÂæ∑","ËëâÂ®ú","Âè∏Á©∫Èúá","ÁãÇÈêµ","Ë≤ùÊèö","Â§èÊ¥õÁâπ","Âá±Ê†ºË∑ØÂ£´",
    "ÁëûÂÖã","‰∫ûÈÄ£","ÂÆâÊ†ºÂàó","ËâæÁø†Áµ≤","Â§úÂß¨","Ëé´Êãâ","Áë™Ëø¶","Êµ∑Ë´æ",
    "Ë∂ôÈõ≤","ÁëüÊñêÊñØ","ÈùíÁ°Ø","ÊØîÊ¥õÁàæ","ÂàÄÈãíÂØ∂Ë≤ù","Ê¥õÂÖã","ÁßëÈáåÁ¥çÂç°","Á¥çÂÖãÁæÖÊñØ","Á∂∫Ëòø","ÊòüËëµ",
    "ÊÇüÁ©∫","ÊΩòÂõ†","Â•éÂÄ´","Á•ñÂç°","ÂëÇÂ∏É","Âá±ÊÅ©","ÈΩäÁàæ","Â∏ÉËêäÁâπ","ÈñÉÈõª‰ø†","ËòáÈõ¢",
    "Ëò≠Èê∏","ÈúßÂ∑±","ÂüÉÁæÖ","Á•ûÂäõÂ•≥Ë∂Ö‰∫∫",
    "ÊãâËå≤","ËéâËéâÂÆâ","È¢ØÊû∑","ÈòøËå≤Âç°","‰ºäËÄøÂ£´",
    "Á©ÜÂä†Áàµ","‰ºäÊ†º","‰ª§Êúà","ÂúñÂÄ´","Â®úÂ°î‰∫û",
    "ÂÖãÈáåÂ∏å","ÁãÑÊãâÂÖã","Ê¥õÈáåÊòÇ","ÈÇ¶Â∞º","ÁõßËúú‰∫û",
    "Ë≤ÇËü¨","ËñáËèà","ÈòøËêäÊñØÁâπ","‰æùÂ§è","ÈáëÁ¥ç",
    "ËòøÂÖí","ÊôÆÈõ∑Â°î","Âç°Ëéâ","ÈÅîÁàæË•ø","Ëã•‰ºä",
    "Âãá","Ê£ÆÂúñÁàæÁâπ","Âç°Ëä¨Â¶Æ","‰∫•ÁäΩ","ÁâπÁàæÂÆâÂ®úÁµ≤",
    "Âá°ÊÅ©","Â†á","Ëòá","ÈùàÈùà","Âè≤Ëò≠Ëå≤","Á∑πËéâ",
    "ËâæÁê≥","ÊãâÁ∂≠Áàæ","Êë©ÊÅ©","Â∏åÈú≤Âç°","Á¥¢Êñá",
    "Ëè≤Â∞ºÂÖã","Áê≥ËíÇ","ÁÄæ","Êµ∑ÂÄ´","ÊÑõÈ∫óÁµ≤","ÊúµËéâ‰∫û",
    "Âç°ÁëûËå≤","Êòé‰∏ñÈö±","ÂÆâÂ•àÁâπ","ËäΩËäΩ","ÁöÆÁöÆ",
    "Ëñ©Â∞º","Âì•Âæ∑Áàæ","ÁâõÈ≠îÁéã","ÊèêÁ±≥","ÊúóÂçö",
    "‰ºØÈ†ì","ÂÖãËêäÊñØ","Êü•ÊààÁ¥çÁàæ","Â§∏ÂÖã","Âè§Êú®",
    "Ê≠êÁ±≥ËåÑ","ËâæÁëû","Ê∏•È¶¨Áàæ","Á∂≠ÁæÖ","ÈòøÊùúÊÅ©",
    "Ë∂Ö‰∫∫","ÈòøÂ°î","Ë¥äÂ∞ºÁàæ","Ë´æÂèØË•ø","Ëé´ÊâòÊñØ","ÈäÄÊôù","È¶¨Ê¥õÊñØ"];
    const phaseSequence = [
      { team: "b", action: "Ban", count: 1 }, { team: "r", action: "Ban", count: 1 },
      { team: "b", action: "Ban", count: 1 }, { team: "r", action: "Ban", count: 1 },
      { team: "b", action: "Pick", count: 1 }, { team: "r", action: "Pick", count: 2 },
      { team: "b", action: "Pick", count: 2 }, { team: "r", action: "Pick", count: 1 },
      { team: "r", action: "Ban", count: 1 }, { team: "b", action: "Ban", count: 1 },
      { team: "r", action: "Ban", count: 1 }, { team: "b", action: "Ban", count: 1 },
      { team: "r", action: "Pick", count: 1 }, { team: "b", action: "Pick", count: 2 },
      { team: "r", action: "Pick", count: 1 }
    ];

  let teamAName = "AÈöä", teamBName = "BÈöä";
  let score = { A: 0, B: 0 };
  let currentGame = 0, maxGame = 5;
  let sideChooser = "A";
  let sideToTeam = { b: "", r: "" };
  let sideSelected = false;
  let allPicks = {};
  heroes.forEach(h => allPicks[h] = { A: false, B: false });
  let picks = { b: [], r: [] }, bans = { b: [], r: [] };
  const selectedHeroes = new Set();
  let useUltimateBattle = false;
  let isUltimate = false;

  let phaseIndex = 0, phaseActionCount = 0;
  let matchHistory = [];
  let matchResults = [];

  function startSeries() {
    teamAName = document.getElementById("teamA").value;
    teamBName = document.getElementById("teamB").value;
    maxGame = parseInt(document.getElementById("boMode").value);
    useUltimateBattle = document.getElementById("ultimateCheck").checked;

    if (teamAName === teamBName) {
      alert("Ë´ãÈÅ∏Êìá‰∏çÂêåÈöä‰ºçÔºÅ");
      return;
    }

    score = { A: 0, B: 0 };
    currentGame = 1;
    sideChooser = "A";
    document.getElementById("teamSelect").style.display = "none";
    document.getElementById("sideSelect").style.display = "block";
    setupSideButtons();
    updateScoreboard();
  }


    function setupSideButtons() {
    const chooserName = sideChooser === "A" ? teamAName : teamBName;
    document.getElementById("sideSelectPrompt").innerText = `GAME ${currentGame} , ${chooserName} chooses a side`;
    document.getElementById("btnBlue").onclick = () => selectSide(sideChooser, "b");
    document.getElementById("btnRed").onclick = () => selectSide(sideChooser, "r");
  }

  function selectSide(team, side) {
    sideToTeam = side === "b" ? { b: team, r: team === "A" ? "B" : "A" }
                              : { r: team, b: team === "A" ? "B" : "A" };
    sideSelected = true;

    isUltimate = (useUltimateBattle && currentGame === 7 &&  maxGame === 7 && score.A === 3 && score.B === 3);

    document.getElementById("sideSelect").style.display = "none";
    document.getElementById("heroSection").style.display = "block";
    document.getElementById("blueTitle").innerText = `üîµ ${sideToTeam.b === "A" ? teamAName : teamBName}`;
    document.getElementById("redTitle").innerText = `üî¥ ${sideToTeam.r === "A" ? teamAName : teamBName}`;
    setupVictoryButtons();
    renderPhase();
    renderHeroes();
  }

  function setupVictoryButtons() {
    const btnA = document.getElementById("btnWinA");
    const btnB = document.getElementById("btnWinB");
    btnA.innerText = `${teamAName} Win`;
    btnB.innerText = `${teamBName} Win`;
    btnA.onclick = () => setWinner("A");
    btnB.onclick = () => setWinner("B");
  }
  function resetCurrentGame() {

  // Ê∏ÖÈô§Ë©≤Â±ÄÂÖßÈÉ®Á¥ÄÈåÑÔºà‰∏çÂΩ±ÈüøÂÖ®Â±ÄË®òÈåÑÔºâ
  selectedHeroes.clear();
  picks = { b: [], r: [] };
  bans = { b: [], r: [] };
  phaseIndex = 0;
  phaseActionCount = 0;
  updateBPTable();

  // Èö±ËóèÂãùË≤†ÈÅ∏ÊìáÔºåÂõûÂà∞ÈÅ∏ËßíÈöéÊÆµ
  document.getElementById("winnerSelect").style.display = "none";
  document.getElementById("btnWinA").disabled = true;
  document.getElementById("btnWinB").disabled = true;

  renderPhase();
  renderHeroes();
}

  function setWinner(winner) {
    picks.b.forEach(h => { allPicks[h][sideToTeam.b] = true; });
    picks.r.forEach(h => { allPicks[h][sideToTeam.r] = true; });
    matchHistory.push({
      bluePick: picks.b.slice(),
      redPick: picks.r.slice(),
      blueBan: bans.b.slice(),
      redBan: bans.r.slice()
        });
    score[winner]++;
    const loser = winner === "A" ? "B" : "A";
    sideChooser = loser;

    // Êñ∞Â¢ûÔºöË®òÈåÑÊú¨Â±ÄÂãùË≤†Ë≥áË®ä
    matchResults.push({
      game: currentGame,
      winner: winner,
      blue: sideToTeam.b,
      red: sideToTeam.r
    });

    currentGame++;
    document.getElementById("btnWinA").disabled = true;
    document.getElementById("btnWinB").disabled = true;

    if (score[winner] > Math.floor(maxGame / 2)) {
      alert(`Á≥ªÂàóË≥ΩÁµêÊùüÔºåÁç≤ÂãùÈöä‰ºçÔºö${winner === "A" ? teamAName : teamBName}`);
      updateScoreboard();
      updateHistory();
      return;
    }

    resetForNextGame();
    setupSideButtons();
    document.getElementById("sideSelect").style.display = "block";
    updateScoreboard();
    updateHistory();

  }

  function updateScoreboard() {
    document.getElementById("scoreBoard").innerText =
      `${teamAName} ${score.A} : ${score.B} ${teamBName}`;
  }

  function resetForNextGame() {
    selectedHeroes.clear();
    picks = { b: [], r: [] };
    bans = { b: [], r: [] };
    phaseIndex = 0;
    phaseActionCount = 0;
    sideSelected = false;
    isUltimate = false;
    updateBPTable();
  }


function renderPhase() {
  // Â∑îÂ≥∞Áõ≤ÈÅ∏Ê¢ù‰ª∂ÔºàÁ¨¨‰∏ÉÂ±Ä + ÈõôÊñπ3Âãù + ÊúâÂãæÈÅ∏Â∑îÂ≥∞Ôºâ
  const isSeventhGame = (currentGame === 7 && maxGame === 7 && score.A === 3 && score.B === 3);
  const isBlind = useUltimateBattle && isSeventhGame;

  // Ëã•ÁÇ∫Â∑îÂ≥∞Â∞çÊ±∫Áõ≤ÈÅ∏ÔºåË∑≥ÈÅé Ban ÈöéÊÆµ
  if (isBlind) {
    while (phaseSequence[phaseIndex]?.action === "Ban") {
      phaseIndex++;
    }
  }
  const p = phaseSequence[phaseIndex];
  if (!p) {
    document.getElementById("bpStageInfo").innerText = "‚úÖ BP ÂÆåÊàêÔºåË´ãÈÅ∏ÊìáÂãùÈöä";
    document.getElementById("winnerSelect").style.display = "block";
    document.getElementById("btnWinA").disabled = false;
    document.getElementById("btnWinB").disabled = false;
  } else {
    const currentTeam = sideToTeam[p.team];
    const teamName = currentTeam === "A" ? teamAName : teamBName;
    document.getElementById("bpStageInfo").innerText =
      `ÁõÆÂâçÈöéÊÆµÔºö${p.action}Ôºà${teamName}Ôºâ`;
    document.getElementById("winnerSelect").style.display = "none";
    document.getElementById("btnWinA").disabled = true;
    document.getElementById("btnWinB").disabled = true;
  }
}
function renderHeroes() {
  const phase = phaseSequence[phaseIndex]; 
  const container = document.getElementById("heroes");
  container.innerHTML = "";

  const isSeventhGame = (currentGame === 7 && maxGame === 7 && score.A === 3 && score.B === 3);
  const isBlind = useUltimateBattle && isSeventhGame;

  heroes.forEach(hero => {
    const div = document.createElement("div");
    div.className = "hero";
    div.innerText = hero;

    if (!sideSelected) {
      div.style.visibility = "hidden";
      container.appendChild(div);
      return;
    }

    const currentTeam = sideToTeam[phase?.team];
    const currentSide = phase?.team;

    const pickedThisGame = picks.b.includes(hero) || picks.r.includes(hero);
    const bannedThisGame = bans.b.includes(hero) || bans.r.includes(hero);
    const usedByThisTeam = allPicks[hero][currentTeam];
    const usedByBoth = allPicks[hero].A && allPicks[hero].B;

    let disable = false;

    // üü° Â∑îÂ≥∞Â∞çÊ±∫ÔºàÁõ≤ÈÅ∏ÔºâÔºöÂÖÅË®±ÈöäÈñìÈáçË§áÔºå‰ΩÜÈöäÂÖß‰∏çÂèØÈáçË§á
    if (isBlind) {
      disable = picks[currentSide].includes(hero);
    } 
    // üîµ Á¨¨‰∏ÉÂ±ÄÔºàÈùûÁõ≤ÈÅ∏ÔºâÂÖ®ÈñãÔºå‰∏çÈôêÂà∂ÈöäÈñìÈáçË§á
    else if (isSeventhGame && !isBlind) {
      disable = pickedThisGame || bannedThisGame;
    }
    // üî¥ ‰∏ÄËà¨Â±ÄÊï∏ÔºàBPÈôêÂà∂Ôºâ
    else {
      if (phase?.action === "Pick") {
        disable = pickedThisGame || bannedThisGame || usedByThisTeam || usedByBoth;
      } else {
        disable = pickedThisGame || bannedThisGame || usedByBoth;
      }
    }

    if (disable) {
      div.classList.add("used");
      div.style.opacity = 0.4;
      div.style.pointerEvents = "none";
    } else {
      div.onclick = () => handleHeroClick(hero);
    }

    container.appendChild(div);
  });
}

function handleHeroClick(hero) {
  const phase = phaseSequence[phaseIndex];
  if (!phase) return;

  const { team, action } = phase;
  const teamKey = sideToTeam[team];

  const isSeventhGame = (currentGame === 7 && maxGame === 7 && score.A === 3 && score.B === 3);
  const isBlind = useUltimateBattle && isSeventhGame;

  if (isBlind) {
    if (picks[team].includes(hero)) return;
    picks[team].push(hero);
  } else {
    if (selectedHeroes.has(hero)) return;
    selectedHeroes.add(hero);
  }

  if (action === "Pick") {
    picks[team].push(hero);
  } else {
    bans[team].push(hero);
  }

  updateBPTable();

  phaseActionCount++;
  if (phaseActionCount >= phase.count) {
    phaseIndex++;
    phaseActionCount = 0;
  }

  renderPhase();
  renderHeroes();
}

function updateBPTable() {
  // Êõ¥Êñ∞ËóçÊñπ Ban
  for (let i = 0; i < 4; i++) {
    const cell = document.getElementById(`blueBan${i + 1}`);
    cell.innerText = bans.b[i] || "";
  }

  // Êõ¥Êñ∞ËóçÊñπ Pick
  for (let i = 0; i < 5; i++) {
    const cell = document.getElementById(`bluePick${i + 1}`);
    cell.innerText = picks.b[i] || "";
  }

  // Êõ¥Êñ∞Á¥ÖÊñπ Ban
  for (let i = 0; i < 4; i++) {
    const cell = document.getElementById(`redBan${i + 1}`);
    cell.innerText = bans.r[i] || "";
  }

  // Êõ¥Êñ∞Á¥ÖÊñπ Pick
  for (let i = 0; i < 5; i++) {
    const cell = document.getElementById(`redPick${i + 1}`);
    cell.innerText = picks.r[i] || "";
  }
}

function updateHistory() {
  const history = document.getElementById("historyTable");
  history.innerHTML = "";

  const header = document.createElement("tr");
  const homeName = teamAName;
  const guestName = teamBName;

  header.innerHTML = `
    <th>${homeName} BAN</th><th>${homeName} PICK</th><th>${homeName} RESULT</th>
    <th>GAME</th>
    <th>${guestName} RESULT</th><th>${guestName} PICK</th><th>${guestName} BAN</th>
  `;
  history.appendChild(header);

  matchResults.forEach((result, i) => {
    const gameNum = i + 1;
    const match = matchHistory[i];
    const blue = result.blue;
    const red = result.red;

    const homeIsBlue = blue === "A";
    const homeBan = homeIsBlue ? match.blueBan : match.redBan;
    const homePick = homeIsBlue ? match.bluePick : match.redPick;
    const guestBan = homeIsBlue ? match.redBan : match.blueBan;
    const guestPick = homeIsBlue ? match.redPick : match.bluePick;

    const homeResult = result.winner === "A" ? "WIN" : "LOSE";
    const guestResult = result.winner === "B" ? "WIN" : "LOSE";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${homeBan.map(h => `<span style="color:${homeIsBlue ? 'blue' : 'red'}">${h}</span>`).join(", ")}</td>
      <td>${homePick.map(h => `<span style="color:${homeIsBlue ? 'blue' : 'red'}">${h}</span>`).join(", ")}</td>
      <td>${homeResult}</td>
      <td style="font-weight:bold;">${gameNum}</td>
      <td>${guestResult}</td>
      <td>${guestPick.map(h => `<span style="color:${homeIsBlue ? 'red' : 'blue'}">${h}</span>`).join(", ")}</td>
      <td>${guestBan.map(h => `<span style="color:${homeIsBlue ? 'red' : 'blue'}">${h}</span>`).join(", ")}</td>
    `;
    history.appendChild(row);
  });
}

  </script>
</body>
</html>
